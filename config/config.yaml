# Charly Neuromorphic Simulation Configuration
# =============================================

# Random Seed (for reproducibility)
SEED: 42

# =============================================================================
# Neural Substrate Parameters
# =============================================================================

# Neuron counts
NEURON_COUNT: 21920          # Total neurons in substrate
HEAD_COUNT: 2000             # Sensory/innate region (indices 0 to HEAD_COUNT-1)
TAIL_COUNT: 20000            # Motor/output region start index

# Charge dynamics (tuned for slower propagation)
CHARGE_MIN: 100             # Minimum charge required for neuron to fire
RECHARGE_RATE: 20            # Base charge accumulation per iteration
NORMAL_TRIGGER: 100         # Threshold for cumulative signal activation
DEFAULT_CUMULATIVE_INPUT: 2000  # Total synapse weight per neuron

# Elastic parameters
ELASTIC_TRIGGER_PROPAGATION: 0.75    # Elastic trigger preserved with active input
ELASTIC_TRIGGER_DEGRADATION: 1       # Decay per iteration without input
ELASTIC_RECHARGE_PROPAGATION: 0.75   # Elastic recharge preserved
ELASTIC_RECHARGE_DEGRADATION: 1      # Decay per iteration

# Emotional Quantum (EQ)
EQ_MAX: 255                 # Maximum absolute EQ value
DEFAULT_MIN_EQ: -3          # Random initialization minimum
DEFAULT_MAX_EQ: 3           # Random initialization maximum
STAR_LEVEL: 20              # Minimum |EQ| for star classification

# Connectome generation
LINKS_PER_NEURON_MIN: 30     # Minimum synapses per neuron
LINKS_PER_NEURON_MAX: 200   # Maximum synapses per neuron
LINK_LENGTH_MAX: 350        # Maximum index distance for connections

# Link length distribution bands (percent of LINK_LENGTH_MAX)
LINK_LEN_SHORT_RANGE: 10    # Short links: 0% to 10% of max (0-35 for max=350)
LINK_LEN_LONG_RANGE: 10     # Long links: 90% to 100% of max (315-350 for max=350)
                            # Mid links: 10% to 90% of max (35-315 for max=350)

# Default distribution [short%, mid%, long%] - must sum to 100
LINK_DISTRIBUTION_DEFAULT: [80, 15, 5]

# =============================================================================
# Connectome Distribution Segments
# =============================================================================
# Define link length distribution by neuron ranges.
# Each segment specifies: start, end, distribution [short%, mid%, long%]
# Neurons not covered use LINK_DISTRIBUTION_DEFAULT.
#
# "Zebra" pattern: alternating local (80-15-5) and distant (5-15-80) connectivity

connectome_distribution:
  # Segment 1: neurons 2000-4000 - local connectivity
  - start: 2000
    end: 6000
    distribution: [90, 5, 5]

  # Segment 2: neurons 4000-6000 - distant connectivity
  - start: 6000
    end: 10000
    distribution: [1, 1, 98]

  # Segment 3: neurons 6000-8000 - local connectivity
  - start: 10000
    end: 22000
    distribution: [98, 2, 0]



# History
HISTORY_MAXLEN: 256         # Maximum neuron activation history length

# Timing
DAY_STEPS: 1080             # Iterations per day phase

# =============================================================================
# Physical Model Parameters
# =============================================================================

WORLD_SIZE: 1920            # Size of 1D world in pixels

# =============================================================================
# Visualization Parameters
# =============================================================================

NEURON_POSITIVE_COLOR: [0, 255, 0]    # Green for positive EQ
NEURON_NEGATIVE_COLOR: [255, 0, 0]    # Red for negative EQ
NEURON_BG_COLOR: [0, 0, 0]            # Black background
HEAD_INACTIVE_COLOR: [14, 14, 14]     # Dark grey for inactive head neurons

VISUALIZATION_WIDTH: 1920             # Output image width
VISUALIZATION_HEIGHT: 1080            # Output image height
CES_STRIP_WIDTH: 100                  # Width of ESP/ESN waveform strip
ACTUATOR_STRIP_WIDTH: 100             # Width of actuator output strip

# CES Strip Colors (Cumulative Emotional State)
CES_BG_COLOR: [14, 14, 14]              # Dark green background
CES_ESP_COLOR: [14, 238, 14]        # Light green for ESP (positive)
CES_ESN_COLOR: [235, 14, 14]            # Red for ESN (negative)
CES_GRID_COLOR: [24, 24, 24]          # Dark grey grid lines
CES_GRID_SPACING: 25                  # Grid line spacing in pixels

# =============================================================================
# Input Receptors (Sensor -> Neuron mappings)
# Population coding with Stevens' power law for psychophysical accuracy
# =============================================================================

inputs:
  # Eye sensor: 50-neuron population with psychophysical mapping
  - signal: "eye"
    type: "population"
    neuron_start: 1500              # First neuron index
    neuron_count: 500             # Spread signal across 50 neurons
    gamma: 0.4                   # Stevens' power law exponent for brightness
    eq_gradient:                 # All negative EQ (light perception is costly)
      low: -10                   # Low-index neurons (dim light)
      high: -200                 # High-index neurons (bright light)

# =============================================================================
# Output Actuators (Neuron -> Actuator mappings)
# =============================================================================
# Each actuator: name, start, count, default_eq, color
# Neurons from start to start+count-1 are assigned to the actuator
# EQ is assigned to each participating neuron
# Color is used for visualization in the actuator strip

actuators:
  - name: "motor"
    start: 20000              # Near TAIL_COUNT
    count: 100                # 100 neurons
    default_eq: 25            # Positive EQ for motor activity
    color: [0, 200, 255]      # Cyan for motor output

# =============================================================================
# Innate Generators
# =============================================================================

innates:
  # Hunger generator: fires periodically, positive motivation
  hunger_generator:
    idx: 60
    eq: 25
    charge_cycle: 100
    inputs: []

  # Satisfaction detector: responds to bright light (high-index eye neurons)
  satisfaction_detector:
    idx: 61
    eq: 30
    charge_cycle: 0
    inputs:
      - [45, 300]    # Connected to eye_45 (bright-responsive)
      - [48, 400]    # Connected to eye_48 (very bright-responsive)
      - [49, 500]    # Connected to eye_49 (maximum brightness)

  # Pain detector: responds to darkness (absence of light)
  # Fires when eye population is mostly inactive
  pain_detector:
    idx: 62
    eq: -30
    charge_cycle: 0
    inputs:
      - [0, 800]    # Connected to eye_0 (always fires if any light)

# =============================================================================
# Named Neurons (aliases for monitoring)
# =============================================================================

named:
  motor_start: 20000        # First motor neuron (at TAIL_COUNT)
  motor_mid: 20050          # Middle motor neuron
  motor_end: 20099          # Last motor neuron
  light_seeker: 100
  eye_low: 0                # First eye neuron (always active if any light)
  eye_mid: 25               # Middle eye neuron
  eye_high: 49              # Last eye neuron (only active at max brightness)
  hunger: 60
  satisfaction: 61
  pain: 62

# =============================================================================
# Sauron's Finger - Dynamic Substrate Modification
# =============================================================================
# Press on neurons to modify their parameters using executable formulas.
#
# Parameters:
#   name:     Identifier for the finger press
#   x:        Center neuron index
#   r:        Radius (neurons affected on each side of center)
#   field:    Neuron attribute to modify:
#             elastic_trigger, elastic_recharge, charge, cumulative_signal
#   formula:  Executable formula for final effect: neuron[idx].field = eval(formula)
#   shape:    Radial distribution formula (evaluated per neuron)
#   rows:     Temporal activation windows with pressure distribution
#             Each row: start, end, formula
#
# Available macros in formulas:
#   IDX   - Current neuron index
#   X     - Finger center (x)
#   R     - Finger radius (r)
#   DIST  - Distance from center: abs(IDX - X)
#   PREV  - Previous value of the field
#   SHAPE - Evaluated radial shape value [0..1]
#   ROW   - Current iteration (in row formula)
#   TEMPORAL - Evaluated row formula value
#
# Math functions available: exp, sin, cos, sqrt, abs, min, max, pi

saurons_finger:
  # Gaussian recharge boost at neuron 10000, iterations 400-600
  - name: "recharge_boost"
    x: 19000
    r: 500
    field: "elastic_recharge"
    formula: "PREV + 15 * SHAPE * TEMPORAL"
    shape: "exp(-0.5 * ((DIST / (R / 2.5)) ** 2))"
    rows:
      - start: 400
        end: 600
        formula: "1.0"

  # Gaussian trigger boost at neuron 12000, ramping up then down
  - name: "trigger_boost"
    x: 19500
    r: 600
    field: "elastic_trigger"
    formula: "PREV + 150 * SHAPE * TEMPORAL"
    shape: "exp(-0.5 * ((DIST / (R / 2.5)) ** 2))"
    rows:
      - start: 400
        end: 600
        formula: "(ROW - 400) / 200"
      - start: 600
        end: 800
        formula: "1.0 - (ROW - 600) / 200"
