# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Charly** is a neuromorphic cellular automaton simulation framework that tests whether a neural substrate can learn to react appropriately to a physical model of reality. The current implementation simulates a "worm-like" agent navigating a 1D world, responding to light stimuli.

## Directory Structure

```
socio/
├── run.bat             # Run the simulation
├── build.bat           # Rebuild sources using Claude Code
├── config/
│   └── config.yaml     # Simulation configuration
├── src/
│   ├── __init__.py
│   ├── physical_model.py   # Abstract base class
│   ├── model_linear.py     # Linear 1D world
│   ├── charly.py           # Neural substrate
│   └── main.py             # CLI application
├── devlogs/            # Conversation exports
└── *.md                # Prompt/specification files
```

## Build Process

This project uses **prompt-driven development**:
1. Specifications are defined in `.md` prompt files
2. Source code in `src/` is generated by Claude Code based on prompts
3. When regenerating sources, **clean `src/` but preserve `config/`**

### Batch Files

**run.bat** - Run the simulation:
```batch
run.bat [days] [output_dir]
```

**build.bat** - Regenerate sources from prompts:
```batch
build.bat
```

## Commands

### Installation
```bash
pip install PyYAML Pillow numpy opencv-python
```

### Running Simulation
```batch
run.bat 5              # Run 5 days
run.bat 10 results     # Run 10 days, output to results/
```

Or directly:
```bash
cd src
python main.py --config ../config/config.yaml --days 5 --output output
```

### CLI Arguments
- `--config`, `-c` - Configuration file path
- `--days` - Number of simulation days
- `--output` - Output directory for results
- `--fps` - Video frames per second
- `--no-video` - Skip video generation

## Architecture

### Three-Tier Design

1. **Physical Model Layer** (`src/physical_model.py`, `src/model_linear.py`)
   - Abstract base class `PhysicalModel` defining sensor/actuator interface
   - `Linear` implementation: 1D world with agent and lamp
   - See [physics.md](physics.md) for formulas and data flow

2. **Neural Substrate Layer** (`src/charly.py`)
   - `Neuron`, `Synapse`, `Connectome` dataclasses
   - `Charly` class: neural network orchestration
   - See [neuron.md](neuron.md) for neuron processing algorithm
   - See [substrate.md](substrate.md) for substrate composition

3. **Integration Layer** (`src/main.py`)
   - CLI entry point with argparse
   - Configuration loading, simulation loop, video generation
   - See [application.md](application.md) for CLI usage

### Prompt Files (Specifications)

| File | Specifies |
|------|-----------|
| [physics.md](physics.md) | PhysicalModel interface, Linear world, math formulas |
| [neuron.md](neuron.md) | Neuron structure, `_process_neuron()` algorithm |
| [substrate.md](substrate.md) | Charly class, connectome, day/night cycles, visualization |
| [application.md](application.md) | CLI usage, execution flow |
| [sequence.md](sequence.md) | SequenceGenerator DSL (future use) |

## Configuration (config/config.yaml)

```yaml
SEED: 42                    # Random seed
NEURON_COUNT: 1920          # Total neurons
HEAD_COUNT: 200             # Input processing neurons
DAY_STEPS: 1080             # Iterations per day
CHARGE_MIN: 100             # Minimum activation threshold
NORMAL_TRIGGER: 500         # Cumulative signal threshold

inputs:                     # Sensor-to-neuron mappings
actuators:                  # Neuron-to-actuator mappings
innates:                    # Pre-wired generator neurons
```

## Development Notes

- **devlogs/** - Store conversation exports here
- When rebuilding: clean `src/`, keep `config/`
- All source files are generated from prompt specifications
- Configuration is preserved across rebuilds
