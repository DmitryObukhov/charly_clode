# Charly - Neuromorphic Simulation Framework

**Version 0.1** - Elastic Control Proof of Concept

Charly is a neuromorphic cellular automaton simulation that tests whether a neural substrate can learn to react appropriately to a physical model of reality. This version proves that **elastic control mechanisms (Sauron's Finger) can modulate the Cumulative Emotional State (CES)**.

## Quick Start

```batch
run.bat 5              # Run simulation for 5 days
run.bat 10 results     # Run 10 days, output to results/
```

## Project Structure

```
charly/
├── run.bat             # Run the simulation
├── build.bat           # Rebuild sources using Claude Code
├── config/
│   └── config.yaml     # Simulation configuration
├── src/
│   ├── physical_model.py   # Abstract base class
│   ├── model_linear.py     # Linear 1D world
│   ├── charly.py           # Neural substrate
│   └── main.py             # CLI application
├── devlogs/            # Conversation exports
├── CLAUDE.md           # Claude Code guide
├── physics.md          # Physical model spec
├── neuron.md           # Neuron structure spec
├── substrate.md        # Substrate spec
├── sequence.md         # SequenceGenerator DSL
└── application.md      # CLI application spec
```

## Batch Files

### run.bat
Runs the simulation with specified parameters:
```batch
run.bat [days] [output_dir]
```
- `days`: Number of simulation days (default: 1)
- `output_dir`: Output directory (default: output)

### build.bat
Invokes Claude Code to regenerate all source files from prompt specifications:
```batch
build.bat
```
- Cleans `src/` directory
- Preserves `config/` files
- Regenerates code from `*.md` prompt files

## Development

The project uses a prompt-driven development approach:
1. Specifications are defined in `.md` prompt files
2. Source code is generated by Claude Code based on prompts
3. `build.bat` regenerates sources when prompts change

### Prompt Files
| File | Specifies |
|------|-----------|
| `physics.md` | PhysicalModel interface, Linear world, formulas |
| `neuron.md` | Neuron structure, `_process_neuron()` algorithm |
| `substrate.md` | Charly class, connectome, day/night cycles |
| `application.md` | CLI usage, execution flow |
| `sequence.md` | SequenceGenerator DSL |

## Checkpoints

### v0.1 - Elastic Control Proof of Concept (Current)
**Key Finding**: Elastic control via Sauron's Finger can modulate CES (Cumulative Emotional State).

Features:
- **Connectome Distribution**: Configurable link length distribution per neuron segment
  - 3-band system: short/mid/long links with percentage allocation
  - "Zebra" pattern support: alternating local (80-15-5) and distant (5-15-80) connectivity
- **Sauron's Finger v2**: Formula-based dynamic substrate modification
  - Executable formulas with macros: IDX, X, R, DIST, PREV, SHAPE, TEMPORAL, ROW
  - Radial shape formulas (gaussian, custom)
  - Temporal row windows with pressure distribution
- **Actuator System**: Redesigned with EQ assignment and visualization
  - Format: name, start, count, default_eq, color
  - Actuator strip visualization with per-actuator colors
  - TAIL_COUNT parameter for motor region
- **Visualization Enhancements**:
  - Unscaled ESP/ESN strip overlay
  - Actuator output strip with configurable width
  - White 1px separators between body/actuator/CES strips
  - Dark grey background for head and actuator neurons

### Population Coding & Visualization
- **Population-coded inputs**: Eye sensor spreads luminosity across neurons using Stevens' power law
- **Thermometer coding**: Low luminosity activates few neurons, high luminosity activates many
- **CES waveform display**: ESP (light green) and ESN (red) as waveform dots with grid
- **Inactive head neurons**: Displayed as dark grey in visualization
- **Linear lamp movement**: Lamp moves left-to-right once per day
- **Physical model visualization**: Generates `physical_*.png` showing agent/lamp positions

### Source Generation
Generated implementation in `src/` based on prompt specifications.

### Combined the Prompts
Initial checkpoint consolidating specifications from original `main_prompt.txt` into modular prompt files.
